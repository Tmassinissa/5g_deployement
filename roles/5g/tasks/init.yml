---
- name: Download Helm signing key
  become: yes
  get_url:
    url: "https://baltocdn.com/helm/signing.asc"
    dest: "/etc/apt/keyrings/helm.asc"

- name: Grant read permissions to helm.asc file
  file:
    path: /etc/apt/keyrings/helm.asc
    mode: 'a+r'
  become: yes

- name: Install apt-transport-https package
  apt:
    name: apt-transport-https
    state: present
    update_cache: yes
  become: yes

- name: Add Helm repository to Apt sources
  ansible.builtin.shell: 
    cmd: echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/helm.asc] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee -a /etc/apt/sources.list.d/helm-stable-debian.list
  become: yes

- name: Update apt package cache
  become: yes
  apt:
    update_cache: yes

- name: Install Helm
  become: yes
  apt:
    name: helm
